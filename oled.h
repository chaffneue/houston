/*
i2c based OLED Display driver for Houston
This is an adaptation of SeeedGrayOLED and TWI with specific changes
to suit Houston's scheduler - this library should work with many SSD1327 based 
OLED displays

@author Richard Hoar <richard.hoar@streeme.com>
@see https://github.com/chaffneue/houston
@see houston.ino for changelog

Derivation Notice - SeedGrayOLED License included
---
 * SSD1327 Gray OLED Driver Library
 *
 * Copyright (c) 2011 seeed technology inc.
 * Author        :   Visweswara R
 * Create Time   :   Dec 2011 - May 2017
 * Change Log    :
 * 
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
 *
---
  twi.c - TWI/I2C library for Wiring & Arduino
  Copyright (c) 2006 Nicholas Zambetti.  All right reserved.

  This library is free software; you can redistribute it and/or
  modify it under the terms of the GNU Lesser General Public
  License as published by the Free Software Foundation; either
  version 2.1 of the License, or (at your option) any later version.

  This library is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
  Lesser General Public License for more details.

  You should have received a copy of the GNU Lesser General Public
  License along with this library; if not, write to the Free Software
  Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA

  Modified 2012 by Todd Krein (todd@krein.org) to implement repeated starts
*/
#ifndef OLED_h
  #define OLED_h

  #define rectRasterCount(rectWidth, rectHeight) ((rectWidth/2 * rectHeight)/16);

  #define I2C_FREQUENCY 280000L
  #define DISPLAY_ADDRESS 0x3c
  #define COMMAND_MODE 0x80
  #define DATA_MODE 0x40
  #define SET_ROW 0x75
  #define SET_COLUMN 0x15
  #define COLUMN_OFFSET 8 // Offset left by 8 pixels
  #define ROW_OFFSET 0    // Starts at 0 


  const unsigned char tempoFont[992] = {
    0x00, 0x09, 0xEF, 0xFE, 0xA0, 0x00, 0x00, 0x02, 0xAF, 0xFF, 0xD0, 0x00, 
    0x06, 0xBD, 0xFF, 0xFC, 0x70, 0x00, 0x06, 0xAD, 0xDF, 0xFD, 0xA2, 0x00, 
    0x00, 0x00, 0x07, 0xFF, 0xFF, 0x70, 0x00, 0xDF, 0xFF, 0xFF, 0xFF, 0xF0, 
    0x00, 0x00, 0x09, 0xCD, 0xFF, 0x70, 0xAF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 
    0x00, 0x2B, 0xEF, 0xFF, 0xC7, 0x00, 0x00, 0x2A, 0xEF, 0xFE, 0xA2, 0x00, 
    0x00, 0x00, 0x00, 0xDF, 0xFF, 0xFF, 0xFE, 0x20, 0x04, 0xCF, 0xFF, 0xFF, 
    0xD0, 0x00, 0xCF, 0xFF, 0xFF, 0xFF, 0xFC, 0x00, 0x7F, 0xFF, 0xFF, 0xFF, 
    0xFE, 0x20, 0x00, 0x00, 0x0F, 0xFF, 0xFF, 0x70, 0x00, 0xFF, 0xFF, 0xFF, 
    0xFF, 0xF0, 0x00, 0x07, 0xFF, 0xFF, 0xFF, 0x70, 0xAF, 0xFF, 0xFF, 0xFF, 
    0xFF, 0xFF, 0x06, 0xFF, 0xFF, 0xFF, 0xFF, 0x90, 0x06, 0xFF, 0xFF, 0xFF, 
    0xFF, 0x60, 0x00, 0x00, 0x0B, 0xFF, 0xFE, 0xEF, 0xFF, 0xD0, 0x0C, 0xFF, 
    0xFF, 0xFF, 0xD0, 0x00, 0xCF, 0xFF, 0xFF, 0xFF, 0xFF, 0x90, 0x0F, 0xFF, 
    0xDE, 0xFF, 0xFF, 0xC0, 0x00, 0x00, 0xAF, 0xFF, 0xFF, 0x70, 0x00, 0xFF, 
    0xFF, 0xFF, 0xFF, 0xF0, 0x00, 0x9F, 0xFF, 0xFF, 0xDD, 0x60, 0xAF, 0xFF, 
    0xFF, 0xFF, 0xFF, 0xFF, 0x2F, 0xFF, 0xFA, 0xAF, 0xFF, 0xF4, 0x2F, 0xFF, 
    0xFD, 0xEF, 0xFF, 0xE0, 0x00, 0x00, 0x4F, 0xFF, 0xC0, 0x0C, 0xFF, 0xF6, 
    0x0A, 0xFF, 0xBF, 0xFF, 0xD0, 0x00, 0x7F, 0xA4, 0x02, 0xCF, 0xFF, 0xD0, 
    0x0A, 0x80, 0x00, 0x6F, 0xFF, 0xF0, 0x00, 0x04, 0xFF, 0xCF, 0xFF, 0x70, 
    0x06, 0xFF, 0xF0, 0x00, 0x00, 0x00, 0x07, 0xFF, 0xFF, 0x90, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x07, 0xFF, 0xF9, 0x9F, 0xFF, 0x60, 0x06, 0xFF, 0xFA, 
    0xAF, 0xFF, 0x90, 0x0A, 0xFF, 0xF9, 0x00, 0x00, 0xAF, 0xFF, 0x40, 0x04, 
    0xFF, 0xFB, 0x06, 0xA2, 0x0F, 0xFF, 0xD0, 0x00, 0x02, 0x00, 0x00, 0x0F, 
    0xFF, 0xF0, 0x00, 0x00, 0x00, 0x0D, 0xFF, 0xF0, 0x00, 0x0C, 0xFF, 0x6F, 
    0xFF, 0x70, 0x07, 0xFF, 0xD0, 0x00, 0x00, 0x00, 0x0F, 0xFF, 0xF2, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x0D, 0xFF, 0xF0, 0xAF, 0xFF, 0x20, 0x00, 
    0xFF, 0xFA, 0xFF, 0xFF, 0x00, 0x00, 0xFF, 0xFC, 0x00, 0x00, 0xDF, 0xFF, 
    0x00, 0x00, 0xFF, 0xFD, 0x00, 0x00, 0x0F, 0xFF, 0xD0, 0x00, 0x00, 0x00, 
    0x00, 0x0D, 0xFF, 0xF0, 0x00, 0x00, 0x00, 0x7F, 0xFF, 0xC0, 0x00, 0x7F, 
    0xFD, 0x0F, 0xFF, 0x70, 0x0A, 0xFF, 0xC0, 0x00, 0x00, 0x00, 0x8F, 0xFF, 
    0x76, 0xAA, 0x80, 0x00, 0x00, 0x00, 0x00, 0x8F, 0xFF, 0x90, 0x7F, 0xFF, 
    0xC2, 0x0A, 0xFF, 0xF4, 0xFF, 0xFD, 0x00, 0x00, 0xDF, 0xFF, 0x00, 0x00, 
    0xFF, 0xFD, 0x00, 0x00, 0xDF, 0xFF, 0x00, 0x00, 0x0F, 0xFF, 0xD0, 0x00, 
    0x00, 0x00, 0x00, 0x2F, 0xFF, 0xD0, 0x00, 0x6D, 0xDF, 0xFF, 0xFE, 0x20, 
    0x00, 0xFF, 0xF6, 0x0F, 0xFF, 0x70, 0x0A, 0xFF, 0xFF, 0xFD, 0xA2, 0x00, 
    0xCF, 0xFF, 0xDF, 0xFF, 0xFF, 0x60, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 
    0x0D, 0xFF, 0xFF, 0xEF, 0xFF, 0x90, 0xFF, 0xFF, 0x00, 0x00, 0xEF, 0xFF, 
    0x00, 0x00, 0xFF, 0xFD, 0x00, 0x00, 0xDF, 0xFF, 0x00, 0x00, 0x0F, 0xFF, 
    0xD0, 0x00, 0x00, 0x00, 0x00, 0xBF, 0xFF, 0x90, 0x00, 0x7F, 0xFF, 0xFF, 
    0xF4, 0x00, 0x0A, 0xFF, 0xC0, 0x0F, 0xFF, 0x70, 0x0C, 0xFF, 0xFF, 0xFF, 
    0xFF, 0x80, 0xEF, 0xFF, 0xFF, 0xFF, 0xFF, 0xF4, 0x00, 0x00, 0x09, 0xFF, 
    0xFA, 0x00, 0x02, 0xCF, 0xFF, 0xFF, 0xFC, 0x00, 0xCF, 0xFF, 0xC2, 0x0A, 
    0xFF, 0xFF, 0x00, 0x00, 0xFF, 0xFD, 0x00, 0x00, 0xDF, 0xFF, 0x00, 0x00, 
    0x0F, 0xFF, 0xD0, 0x00, 0x00, 0x00, 0x09, 0xFF, 0xFD, 0x00, 0x00, 0x7F, 
    0xFF, 0xFF, 0xFF, 0x90, 0x2F, 0xFF, 0x20, 0x0F, 0xFF, 0x70, 0x0B, 0xDD, 
    0xDF, 0xFF, 0xFF, 0xF4, 0xFF, 0xFF, 0xC2, 0x2C, 0xFF, 0xFC, 0x00, 0x00, 
    0x0F, 0xFF, 0xF2, 0x00, 0x09, 0xFF, 0xFF, 0xFF, 0xFF, 0xC0, 0x4F, 0xFF, 
    0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0xFF, 0xFD, 0x00, 0x00, 0xDF, 0xFF, 
    0x00, 0x00, 0x0F, 0xFF, 0xD0, 0x00, 0x00, 0x00, 0x9F, 0xFF, 0xF4, 0x00, 
    0x00, 0x00, 0x00, 0x8E, 0xFF, 0xF7, 0xCF, 0xFF, 0xDD, 0xDF, 0xFF, 0xED, 
    0x00, 0x00, 0x00, 0x4E, 0xFF, 0xFA, 0xFF, 0xFE, 0x00, 0x00, 0xFF, 0xFF, 
    0x00, 0x00, 0x9F, 0xFF, 0xA0, 0x00, 0x8F, 0xFF, 0xC4, 0x9F, 0xFF, 0xFA, 
    0x06, 0xFF, 0xFF, 0xFF, 0xFF, 0xFC, 0x00, 0x00, 0xDF, 0xFF, 0x00, 0x00, 
    0xFF, 0xFD, 0x00, 0x00, 0x0F, 0xFF, 0xD0, 0x00, 0x00, 0x09, 0xFF, 0xFF, 
    0x60, 0x00, 0x00, 0x00, 0x00, 0x04, 0xFF, 0xFC, 0xDF, 0xFF, 0xFF, 0xFF, 
    0xFF, 0xFF, 0x00, 0x00, 0x00, 0x04, 0xFF, 0xFD, 0xFF, 0xFD, 0x00, 0x00, 
    0xDF, 0xFF, 0x00, 0x00, 0xFF, 0xFF, 0x20, 0x00, 0xEF, 0xFF, 0x20, 0x02, 
    0xFF, 0xFF, 0x00, 0x07, 0xAA, 0x76, 0xFF, 0xFA, 0x00, 0x00, 0xBF, 0xFF, 
    0x40, 0x04, 0xFF, 0xFB, 0x00, 0x00, 0x0F, 0xFF, 0xD0, 0x00, 0x00, 0xCF, 
    0xFF, 0xF6, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0xFF, 0xFD, 0xDF, 0xFF, 
    0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x02, 0xFF, 0xFC, 0xCF, 0xFF, 
    0x20, 0x00, 0xEF, 0xFF, 0x00, 0x09, 0xFF, 0xFA, 0x00, 0x00, 0xFF, 0xFD, 
    0x00, 0x00, 0xDF, 0xFF, 0x00, 0x00, 0x00, 0x2E, 0xFF, 0xF2, 0x00, 0x00, 
    0x4F, 0xFF, 0xC0, 0x0C, 0xFF, 0xF6, 0x00, 0x00, 0x0F, 0xFF, 0xD0, 0x00, 
    0x2C, 0xFF, 0xFD, 0x20, 0x00, 0x00, 0x0B, 0x60, 0x00, 0x2C, 0xFF, 0xFB, 
    0x00, 0x00, 0x00, 0x0F, 0xFF, 0x70, 0x07, 0x00, 0x00, 0x2C, 0xFF, 0xF9, 
    0x8F, 0xFF, 0xA0, 0x07, 0xFF, 0xFB, 0x00, 0x2F, 0xFF, 0xF2, 0x00, 0x00, 
    0xFF, 0xFF, 0x20, 0x02, 0xFF, 0xFE, 0x00, 0x00, 0x07, 0xEF, 0xFF, 0xA0, 
    0x7F, 0xFA, 0x0C, 0xFF, 0xFE, 0xEF, 0xFF, 0xC0, 0x00, 0x00, 0x0F, 0xFF, 
    0xD0, 0x00, 0xEF, 0xFF, 0xFF, 0xFF, 0xFF, 0xF7, 0x6F, 0xFF, 0xDD, 0xFF, 
    0xFF, 0xF4, 0x00, 0x00, 0x00, 0x0F, 0xFF, 0x70, 0x6F, 0xFD, 0xDD, 0xFF, 
    0xFF, 0xE0, 0x0D, 0xFF, 0xFE, 0xDF, 0xFF, 0xF4, 0x00, 0xAF, 0xFF, 0xA0, 
    0x00, 0x00, 0xAF, 0xFF, 0xFA, 0xAF, 0xFF, 0xF9, 0x09, 0xDD, 0xFF, 0xFF, 
    0xFC, 0x00, 0xFF, 0xFF, 0x02, 0xEF, 0xFF, 0xFF, 0xFE, 0x20, 0x00, 0x00, 
    0x0F, 0xFF, 0xD0, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xF7, 0xAF, 0xFF, 
    0xFF, 0xFF, 0xFF, 0x60, 0x00, 0x00, 0x00, 0x0F, 0xFF, 0x70, 0xAF, 0xFF, 
    0xFF, 0xFF, 0xFD, 0x20, 0x02, 0xEF, 0xFF, 0xFF, 0xFF, 0x60, 0x02, 0xFF, 
    0xFF, 0x20, 0x00, 0x00, 0x0C, 0xFF, 0xFF, 0xFF, 0xFF, 0xB0, 0x0A, 0xFF, 
    0xFF, 0xFF, 0xA0, 0x00, 0xFF, 0xFF, 0x00, 0x0A, 0xEF, 0xFE, 0xA0, 0x00, 
    0x00, 0x00, 0x0F, 0xFF, 0xD0, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xF7, 
    0x08, 0xCD, 0xFF, 0xDC, 0x92, 0x00, 0x00, 0x00, 0x00, 0x0F, 0xFF, 0x70, 
    0x6B, 0xDF, 0xFF, 0xFC, 0x80, 0x00, 0x00, 0x09, 0xDF, 0xFF, 0xB2, 0x00, 
    0x0A, 0xFF, 0xFA, 0x00, 0x00, 0x00, 0x00, 0x7C, 0xFF, 0xFF, 0xC7, 0x00, 
    0x0A, 0xFF, 0xFC, 0xA2, 0x00, 0x00, 0x7F, 0xFA
  };

  class OLED {
    public:
      void begin();
      void drawRect(unsigned int top, unsigned int left, unsigned int width, unsigned int height);
      void raster();
      void setTempo(double tempo);
      void initialize();

    private:
      void sendCommand(unsigned char command);
      void sendData(unsigned char data);
      char sc;
      void pushToTempoBitmap(int number, int numberPosition);
      void pushToTempoBitmap(char none[]);
      void pushToTempoBitmap();
  };
#endif
